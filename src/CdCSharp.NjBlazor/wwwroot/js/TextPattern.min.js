var t;(t||(t={})).TextPatternJsClass=class{constructor(){this.textPatternClickEvents=new WeakMap,this.textPatternInputEvents=new WeakMap,this.textPatternBlurEvents=new WeakMap,this.addTextPatternEvents=(t,e,n,i,s,a,r)=>{const l=()=>this.selectTextOnClick(t);this.textPatternClickEvents.get(t)||(t.addEventListener("click",l),this.textPatternClickEvents.set(t,l));const o=()=>this.goNextOrPrevent(t,e,n,i,s,a,r);this.textPatternInputEvents.get(t)||(t.addEventListener("input",o),this.textPatternInputEvents.set(t,o));const c=()=>this.setDefaultValueNotLength(t,i);this.textPatternBlurEvents.get(t)||(t.addEventListener("blur",c),this.textPatternBlurEvents.set(t,c))},this.selectTextOnClick=t=>{const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e)},this.goNextOrPrevent=(t,e,n,i,s,a,r)=>{if(0==t.innerText.length)return t.innerText=i.defaultValue,void(s&&s.invokeMethodAsync(a,n.innerText));if(t.innerText.length<=i.length){let l=this.getCursorPositionWithinSpan(t),o=i.pattern.replace(/[\\\(\)\^\$]/g,""),c=t.innerText,d=o.substring(0,c.length).split(""),h="";for(let t=0;t<c.length;t++){let e;"w"===d[t]?e=new RegExp("[a-zA-Z]","g").test(c[t]):"d"===d[t]&&(e=new RegExp("[0-9]","g").test(c[t])),e?h+=c[t]:l-=1}if(t.innerText=h,this.setCursorPositionWithinSpan(t,l),t.innerText.length>=i.length){const e=this.findNextEditableBlock(n,t);e&&e.click()}s&&s.invokeMethodAsync(a,n.innerText),t.innerText.length===i.length&&s.invokeMethodAsync(r,e,t.innerText).then((e=>{e||(t.innerText=i.defaultValue)}))}else t.innerText=t.innerText.substring(0,i.length),this.placeCaretAtEnd(t),s&&s.invokeMethodAsync(a,n.innerText)},this.setDefaultValueNotLength=(t,e)=>{t.innerText.length==e.length||(t.innerText=e.defaultValue)},this.getCursorPositionWithinSpan=t=>{let e=0;if(window.getSelection){let n=window.getSelection();if(n&&n.rangeCount>0){let i=n.getRangeAt(0),s=i.cloneRange();s.selectNodeContents(t),s.setEnd(i.startContainer,i.startOffset),e=s.toString().length}}return e},this.setCursorPositionWithinSpan=(t,e)=>{let n=document.createRange(),i=window.getSelection();i&&(n.setStart(t.childNodes[0]||t,e),n.collapse(!0),i.removeAllRanges(),i.addRange(n))},this.findNextEditableBlock=(t,e)=>{let n=!1;for(const i of t.children)if(i===e)n=!0;else if(n&&i instanceof HTMLSpanElement&&"true"===i.contentEditable)return i;return null},this.placeCaretAtEnd=t=>{const e=document.createRange(),n=window.getSelection();e.selectNodeContents(t),e.collapse(!1),n&&(n.removeAllRanges(),n.addRange(e))}}async TextPatternAddDynamic(t,e,n,i,s){if(t.appendChild){t.innerHTML="",this.textPatternClickEvents=new WeakMap,this.textPatternInputEvents=new WeakMap,this.textPatternBlurEvents=new WeakMap;for(let a=0;a<e.length;a++){let r=e[a],l=document.createElement("span");l.innerText=r.value,r.isSeparator||r.isEditable&&(l.setAttribute("contenteditable","true"),this.addTextPatternEvents(l,a,t,r,n,i,s)),t.appendChild(l)}}}},window.TextPatternJs=new t.TextPatternJsClass;
//# sourceMappingURL=TextPattern.min.js.map
